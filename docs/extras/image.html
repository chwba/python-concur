<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.1" />
<title>concur.extras.image API documentation</title>
<meta name="description" content="Scrollable, zoomable image widget with overlay support." />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>concur.extras.image</code></h1>
</header>
<section id="section-intro">
<p>Scrollable, zoomable image widget with overlay support.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34; Scrollable, zoomable image widget with overlay support. &#34;&#34;&#34;
from functools import partial
import copy

import numpy as np
import imgui
from OpenGL.GL import *
from concur.integrations import replace_texture, texture


def _image_begin(state, width=None, height=None):
    &#34;&#34;&#34; A zoomable, draggable image widget.

    Three coordinate systems are in use in the widget:

     - screen space: measured in screen pixels, origin is in the top left corner
         of the widget.
     - image space: measured in texture pixels, origin is in the top left corner
         of the image.
     - GL space: origin is the same as for image space, but the scaling is
         different: (1,1) marks image&#39;s bottom right corner.
    &#34;&#34;&#34;
    if width is None:
        width = imgui.get_content_region_available()[0]
    if height is None:
        height = imgui.get_content_region_available()[1]
    width = max(1, width)
    height = max(1, height)

    state = copy.deepcopy(state)

    draw_list = imgui.get_window_draw_list()
    pos = imgui.get_cursor_screen_pos()
    io = imgui.get_io()
    changed = False

    def screen_to_gl(pos, tex, view, center, zoom, x):
        tex_ratio = tex[0] / tex[1]
        view_ratio = view[0] / view[1]
        return max(1, view_ratio / tex_ratio) / zoom * ((x[0] - pos[0]) / view[0] - 0.5) + center[0], \
               max(1, tex_ratio / view_ratio) / zoom * ((x[1] - pos[1]) / view[1] - 0.5) + center[1]

    def gl_to_screen(pos, tex, view, center, zoom, x):
        tex_ratio = tex[0] / tex[1]
        view_ratio = view[0] / view[1]
        return ((x[0] - center[0]) * zoom / max(1, view_ratio / tex_ratio) + 0.5) * view[0] + pos.x, \
               ((x[1] - center[1]) * zoom / max(1, tex_ratio / view_ratio) + 0.5) * view[1] + pos.y

    scr_to_gl = partial(screen_to_gl, pos, (state.tex_w, state.tex_h), (width, height), state.center, state.zoom)
    gl_to_scr = partial(gl_to_screen, pos, (state.tex_w, state.tex_h), (width, height), state.center, state.zoom)

    tex_ratio = state.tex_w / state.tex_h
    view_ratio = width / height
    pixel = max(width / state.tex_w, height / state.tex_h) * state.zoom
    unit_x = min(width, height * tex_ratio) * state.zoom
    unit_y = min(height, width / tex_ratio) * state.zoom

    is_hovered = io.mouse_pos[0] &lt; width + pos[0] and io.mouse_pos[0] &gt; pos[0] and io.mouse_pos[1] &lt; height + pos[1] and io.mouse_pos[1] &gt; pos[1]

    if (imgui.is_mouse_clicked(1) or imgui.is_mouse_clicked(2)) and is_hovered:
        changed |= not state.is_dragging
        state.is_dragging = True
    if not (imgui.is_mouse_down(1) or imgui.is_mouse_down(2)):
        changed |= state.is_dragging
        state.is_dragging = False

    if state.is_dragging:
        state.center = state.center[0] - io.mouse_delta[0] / unit_x, state.center[1] - io.mouse_delta[1] / unit_y
        changed |= True

    if is_hovered:
        mx, my = scr_to_gl(io.mouse_pos)
        factor = 1.3 ** io.mouse_wheel
        state.zoom *= factor
        state.center = state.center[0] + (mx - state.center[0]) * (1 - 1 / factor), \
                 state.center[1] + (my - state.center[1]) * (1 - 1 / factor)
        changed |= io.mouse_wheel != 0

    uva = scr_to_gl(pos)
    uvb = scr_to_gl((pos[0] + width, pos[1] + height))

    if state.tex_id is not None:
        draw_list.add_image(state.tex_id, (pos.x, pos.y), (pos.x + width, pos.y + height), uva, uvb);

    imgui.push_clip_rect(*pos, pos[0] + width, pos[1] + height, True)

    return \
        changed, \
        state, \
        lambda x: gl_to_scr((x[0] / state.tex_w, x[1] / state.tex_h)), \
        lambda x: [a*b for a, b in zip(scr_to_gl(x), [state.tex_w, state.tex_h])], \
        is_hovered


def _image_end():
    imgui.pop_clip_rect()


class TF(object):
    &#34;&#34;&#34; Transformation object, relating screen space to image space, both in pixels. &#34;&#34;&#34;
    def __init__(self, i2s, s2i, hovered):
        self.i2s = i2s
        self.s2i = s2i
        self.hovered = hovered


def image(name, state, width=None, height=None, content_gen=None):
    &#34;&#34;&#34; The image widget.

    `state` is an instance of `concur.extras.image.ViewState`. Width and
    height are optional; if not specified, the widget stretches to fill
    the parent element.

    `content_gen` is a function that takes as an argument a transformation
    object `concur.extras.image.TF`, and returns a widget that will be displayed as image
    overlay.

    The transformation object can be used to display overlay on the image, positioned
    and scaled appropriately. It can be used explicitly, or passed as the `tf` argument to any
    Geometrical objects. See the [image example](https://github.com/potocpav/python-concur/blob/master/examples/image.py) for example usage.
    &#34;&#34;&#34;
    while True:
        changed, state, im_to_screen, screen_to_im, hovered = \
            _image_begin(state, width, height)

        if content_gen is not None:
            try:
                tf = TF(im_to_screen, screen_to_im, hovered)
                next(content_gen(tf))
            except StopIteration as e:
                _image_end()
                return name, (None, e.value)

        _image_end()
        if changed:
            return name, (state, None)
        else:
            yield


class ViewState(object):
    &#34;&#34;&#34; Image state, contaiining pan and zoom information, and texture data. &#34;&#34;&#34;
    def __init__(self, image=None, center=(0.5, 0.5), zoom=1):
        &#34;&#34;&#34; Initialize view state.

        `image` must be something convertible to `numpy.array`: greyscale or RGB, channel is
        in the last dimension.
        &#34;&#34;&#34;
        import numpy as np
        self.default_center, self.default_zoom = center, zoom
        self.center, self.zoom = center, zoom
        self.is_dragging = False
        if image is None:
            self.tex_id = texture(np.zeros((1,1,3)))
            self.tex_w, self.tex_h = 1, 1
        else:
            self.tex_id = None
            self.change_image(image)

    def change_image(self, image):
        &#34;&#34;&#34; Change the image for a different one. `image` must be something convertible to
        `numpy.array`: greyscale or RGB, channel is in the last dimension.
        &#34;&#34;&#34;
        image = np.array(image)
        self.tex_id = replace_texture(image, self.tex_id)
        self.tex_w, self.tex_h = image.shape[1], image.shape[0]

    def reset_view(self):
        &#34;&#34;&#34; Reset view so that the whole image fits into the widget. &#34;&#34;&#34;
        self.center, self.zoom = self.default_center, self.default_zoom</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="concur.extras.image.image"><code class="name flex">
<span>def <span class="ident">image</span></span>(<span>name, state, width=None, height=None, content_gen=None)</span>
</code></dt>
<dd>
<section class="desc"><p>The image widget.</p>
<p><code>state</code> is an instance of <a title="concur.extras.image.ViewState" href="#concur.extras.image.ViewState"><code>ViewState</code></a>. Width and
height are optional; if not specified, the widget stretches to fill
the parent element.</p>
<p><code>content_gen</code> is a function that takes as an argument a transformation
object <a title="concur.extras.image.TF" href="#concur.extras.image.TF"><code>TF</code></a>, and returns a widget that will be displayed as image
overlay.</p>
<p>The transformation object can be used to display overlay on the image, positioned
and scaled appropriately. It can be used explicitly, or passed as the <code>tf</code> argument to any
Geometrical objects. See the <a href="https://github.com/potocpav/python-concur/blob/master/examples/image.py">image example</a> for example usage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def image(name, state, width=None, height=None, content_gen=None):
    &#34;&#34;&#34; The image widget.

    `state` is an instance of `concur.extras.image.ViewState`. Width and
    height are optional; if not specified, the widget stretches to fill
    the parent element.

    `content_gen` is a function that takes as an argument a transformation
    object `concur.extras.image.TF`, and returns a widget that will be displayed as image
    overlay.

    The transformation object can be used to display overlay on the image, positioned
    and scaled appropriately. It can be used explicitly, or passed as the `tf` argument to any
    Geometrical objects. See the [image example](https://github.com/potocpav/python-concur/blob/master/examples/image.py) for example usage.
    &#34;&#34;&#34;
    while True:
        changed, state, im_to_screen, screen_to_im, hovered = \
            _image_begin(state, width, height)

        if content_gen is not None:
            try:
                tf = TF(im_to_screen, screen_to_im, hovered)
                next(content_gen(tf))
            except StopIteration as e:
                _image_end()
                return name, (None, e.value)

        _image_end()
        if changed:
            return name, (state, None)
        else:
            yield</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="concur.extras.image.TF"><code class="flex name class">
<span>class <span class="ident">TF</span></span>
<span>(</span><span>i2s, s2i, hovered)</span>
</code></dt>
<dd>
<section class="desc"><p>Transformation object, relating screen space to image space, both in pixels.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TF(object):
    &#34;&#34;&#34; Transformation object, relating screen space to image space, both in pixels. &#34;&#34;&#34;
    def __init__(self, i2s, s2i, hovered):
        self.i2s = i2s
        self.s2i = s2i
        self.hovered = hovered</code></pre>
</details>
</dd>
<dt id="concur.extras.image.ViewState"><code class="flex name class">
<span>class <span class="ident">ViewState</span></span>
<span>(</span><span>image=None, center=(0.5, 0.5), zoom=1)</span>
</code></dt>
<dd>
<section class="desc"><p>Image state, contaiining pan and zoom information, and texture data. </p>
<p>Initialize view state.</p>
<p><a title="concur.extras.image.image" href="#concur.extras.image.image"><code>image()</code></a> must be something convertible to <code>numpy.array</code>: greyscale or RGB, channel is
in the last dimension.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewState(object):
    &#34;&#34;&#34; Image state, contaiining pan and zoom information, and texture data. &#34;&#34;&#34;
    def __init__(self, image=None, center=(0.5, 0.5), zoom=1):
        &#34;&#34;&#34; Initialize view state.

        `image` must be something convertible to `numpy.array`: greyscale or RGB, channel is
        in the last dimension.
        &#34;&#34;&#34;
        import numpy as np
        self.default_center, self.default_zoom = center, zoom
        self.center, self.zoom = center, zoom
        self.is_dragging = False
        if image is None:
            self.tex_id = texture(np.zeros((1,1,3)))
            self.tex_w, self.tex_h = 1, 1
        else:
            self.tex_id = None
            self.change_image(image)

    def change_image(self, image):
        &#34;&#34;&#34; Change the image for a different one. `image` must be something convertible to
        `numpy.array`: greyscale or RGB, channel is in the last dimension.
        &#34;&#34;&#34;
        image = np.array(image)
        self.tex_id = replace_texture(image, self.tex_id)
        self.tex_w, self.tex_h = image.shape[1], image.shape[0]

    def reset_view(self):
        &#34;&#34;&#34; Reset view so that the whole image fits into the widget. &#34;&#34;&#34;
        self.center, self.zoom = self.default_center, self.default_zoom</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="concur.extras.image.ViewState.change_image"><code class="name flex">
<span>def <span class="ident">change_image</span></span>(<span>self, image)</span>
</code></dt>
<dd>
<section class="desc"><p>Change the image for a different one. <a title="concur.extras.image.image" href="#concur.extras.image.image"><code>image()</code></a> must be something convertible to
<code>numpy.array</code>: greyscale or RGB, channel is in the last dimension.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def change_image(self, image):
    &#34;&#34;&#34; Change the image for a different one. `image` must be something convertible to
    `numpy.array`: greyscale or RGB, channel is in the last dimension.
    &#34;&#34;&#34;
    image = np.array(image)
    self.tex_id = replace_texture(image, self.tex_id)
    self.tex_w, self.tex_h = image.shape[1], image.shape[0]</code></pre>
</details>
</dd>
<dt id="concur.extras.image.ViewState.reset_view"><code class="name flex">
<span>def <span class="ident">reset_view</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Reset view so that the whole image fits into the widget.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reset_view(self):
    &#34;&#34;&#34; Reset view so that the whole image fits into the widget. &#34;&#34;&#34;
    self.center, self.zoom = self.default_center, self.default_zoom</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="concur.extras" href="index.html">concur.extras</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="concur.extras.image.image" href="#concur.extras.image.image">image</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="concur.extras.image.TF" href="#concur.extras.image.TF">TF</a></code></h4>
</li>
<li>
<h4><code><a title="concur.extras.image.ViewState" href="#concur.extras.image.ViewState">ViewState</a></code></h4>
<ul class="">
<li><code><a title="concur.extras.image.ViewState.change_image" href="#concur.extras.image.ViewState.change_image">change_image</a></code></li>
<li><code><a title="concur.extras.image.ViewState.reset_view" href="#concur.extras.image.ViewState.reset_view">reset_view</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.1</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>